# -*- mode: python -*-
addScheme('normal', '%major.%minor.%release')
addScheme('winrc', '%major,%minor,%release')
main = addModule('monetdb')
main.setVersionFormat('@normal')

# %v - unadorned version number
# %q - version number surrounded by single quotes
# %Q - version number surrounded by double quotes

main.addAnchor("configure.ag", "[MonetDB], [%v]")
main.addAnchor("MonetDB.spec", "%define version %v")
main.addAnchors("NT/rules.msc",
                "VERSION=%v")
main.addAnchors("NT/monetdb_config.h.in",
                'PACKAGE_STRING "MonetDB %v"',
                'PACKAGE_VERSION %Q')
main.addAnchors("gdk/libbat.rc",
                'VALUE "FileVersion", "%v\\0"',
                'VALUE "ProductVersion", "%v\\0"',
                arguments(pattern = 'FILEVERSION %v', format = '@winrc'),
                arguments(pattern = 'PRODUCTVERSION %v', format = '@winrc'))
main.addAnchors("clients/odbc/winsetup/setup.rc",
                'VALUE "FileVersion", %Q',
                'VALUE "ProductVersion", %Q',
                arguments(pattern = 'FILEVERSION %v', format = '@winrc'),
                arguments(pattern = 'PRODUCTVERSION %v', format = '@winrc'))
main.addAnchors("clients/odbc/driver/driver.rc",
                'VALUE "FileVersion", "%v\\0"',
                'VALUE "ProductVersion", "%v\\0"',
                arguments(pattern = 'FILEVERSION %v', format = '@winrc'),
                arguments(pattern = 'PRODUCTVERSION %v', format = '@winrc'))
main.addAnchors("clients/mapilib/mapi.rc",
                'VALUE "FileVersion", "%v\\0"',
                'VALUE "ProductVersion", "%v\\0"',
                arguments(pattern = 'FILEVERSION %v', format = '@winrc'),
                arguments(pattern = 'PRODUCTVERSION %v', format = '@winrc'))
main.addAnchors("clients/python2/setup.py",
                "version=%q,",
                "python2-monetdb-%v.tar")
main.addAnchors("clients/python3/setup.py",
                "version=%q,",
                "python3-monetdb-%v.tar")
main.addAnchors("monetdb5/tools/libmonetdb5.rc",
                'VALUE "FileVersion", "%v\\0"',
                'VALUE "ProductVersion", "%v\\0"',
                arguments(pattern = 'FILEVERSION %v', format = '@winrc'),
                arguments(pattern = 'PRODUCTVERSION %v', format = '@winrc'))
main.addAnchors("NT/installer32/MonetDB-ODBC-Installer.vdproj",
                arguments(pattern = '"ProductVersion" = "8:%v"',
                          format = "@normal"))
main.addAnchors("NT/installer64/MonetDB-ODBC-Installer.vdproj",
                arguments(pattern = '"ProductVersion" = "8:%v"',
                          format = "@normal"))
main.addAnchors("NT/installer32/MonetDB5-Geom-Module.vdproj",
                arguments(pattern = '"ProductVersion" = "8:%v"',
                          format = "@normal"))
main.addAnchors("NT/installer64/MonetDB5-Geom-Module.vdproj",
                arguments(pattern = '"ProductVersion" = "8:%v"',
                          format = "@normal"))
main.addAnchors("NT/installer32/MonetDB5-SQL-Installer.vdproj",
                arguments(pattern = '"ProductVersion" = "8:%v"',
                          format = "@normal"),
                arguments(pattern = r'MonetDB-SQL-%v\\dump-restore.txt',
                          format = "@normal"),
                arguments(pattern = r'MonetDB-SQL-%v\\dump-restore.html',
                          format = "@normal"),
                arguments(pattern = '"8:MonetDB-SQL-%v"',
                          format = "@normal"))
main.addAnchors("NT/installer64/MonetDB5-SQL-Installer.vdproj",
                arguments(pattern = '"ProductVersion" = "8:%v"',
                          format = "@normal"),
                arguments(pattern = r'MonetDB-SQL-%v\\dump-restore.txt',
                          format = "@normal"),
                arguments(pattern = r'MonetDB-SQL-%v\\dump-restore.html',
                          format = "@normal"),
                arguments(pattern = '"8:MonetDB-SQL-%v"',
                          format = "@normal"))
