#materialized views example
r:= bat.new(:oid,:int);
bat.setRole(r,"emp","age");
bat.append(r,1);
bat.append(r,2);
bat.append(r,3);
io.print(r);
s:= bat.new(:oid,:str);
bat.setRole(s,"emp","name");
bat.append(s,"A");
bat.append(s,"B");
bat.append(s,"C");
io.print(s);

factory view1(l:int,h:int):bat[:oid,:str];
a:bat[:oid,:int] := bbp.bind("emp","age");
b:bat[:oid,:str] := bbp.bind("emp","name");
barrier always:= true;
	lOld:= l;
	hOld:= h;
	io.print("recalc");
	c := algebra.select(a,l,h);
	d := algebra.semijoin(b,c);
	barrier available:=true;
		yield d;
		leave available:= lOld != l;
		leave available:= hOld != h;
		io.print("reuse");
		redo available:=true;
	exit available;
	redo always;
exit always;
	return view1:= nil:bat[:oid,:str];
end view1;

e:= user.view1(0,2);
io.print(e);
e:= user.view1(0,2);
io.print(e);
e:= user.view1(0,4);
io.print(e);
factories.shutdown("user","view1");
